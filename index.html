<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PengaduanApp ‚Äì Dashboard</title>

    <!-- Font & Icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/responsive.css" />
    <link rel="stylesheet" href="css/enhanced.css" />
  </head>
  <body>
    <!-- Topbar -->
    <nav class="topbar">
      <div class="topbar-inner">
        <div class="brand">
          <div class="logo">PA</div>
          <div>
            <div style="font-size: 14px; font-weight: 800">PengaduanApp</div>
            <div style="font-size: 12px; color: #ffdede">
              Transparansi | Respons | Aksi
            </div>
          </div>
        </div>

        <div class="top-right">
          <div class="search" title="Cari laporan" style="position: relative">
            <i class="fa fa-search" style="opacity: 0.7"></i>
            <input id="searchInput" placeholder="Cari judul / lokasi..." />
            <div id="searchSuggestions" class="search-suggestions"></div>
          </div>

          <div class="nav-links">
            <button id="btnDashboard">Dashboard</button>
            <button id="btnReports">Daftar Laporan</button>
            <button id="btnRating">Rating</button>
            <button id="btnProfile">Profil</button>
          </div>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="grid">
        <!-- Sidebar -->
        <aside class="sidebar">
          <div class="profile">
            <div class="avatar" id="avatarEl">TR</div>
            <div class="meta">
              <div class="name" id="profileName">Tri</div>
              <div class="email" id="profileEmail">tri@example.com</div>
            </div>
          </div>

          <div class="menu">
            <button class="active" data-page="dashboard">üè† Dashboard</button>
            <button data-page="form">üìù Buat Pengaduan</button>
            <button data-page="reports">üìã Semua Pengaduan</button>
            <button data-page="ratingPage">‚≠ê Rating</button>
            <button data-page="profile">üë§ Profil</button>
          </div>

          <div class="stats" style="margin-top: 16px">
            <div class="stat">
              <div class="num" id="statTotal">0</div>
              <div class="label">Total</div>
            </div>
            <div class="stat">
              <div class="num" id="statOpen">0</div>
              <div class="label">Pending</div>
            </div>
            <div class="stat">
              <div class="num" id="statResolved">0</div>
              <div class="label">Selesai</div>
            </div>
          </div>

          <p class="muted mb-10" style="margin-top: 14px">
            Enhanced v2.0 ‚Ä¢ Chat, GPS, Priority, Auto-Escalation
          </p>
        </aside>

        <!-- Main content -->
        <main class="content">
          <!-- Page: Enhanced Dashboard -->
          <section id="page-dashboard" class="page">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              "
            >
              <div>
                <h2 style="color: #ffbcbc; margin-bottom: 8px">
                  Dashboard Analitik
                </h2>
                <p class="muted mb-10">
                  Statistik lengkap dan monitoring real-time
                </p>
              </div>
              <div style="display: flex; gap: 8px">
                <button id="refreshDashboard" class="btn ghost" title="Refresh">
                  <i class="fa fa-refresh"></i>
                </button>
                <button
                  id="exportDashboard"
                  class="btn ghost"
                  title="Export Dashboard"
                >
                  <i class="fa fa-download"></i> Export
                </button>
              </div>
            </div>

            <!-- Enhanced Stats Cards -->
            <div id="dashboardStats"></div>

            <!-- Charts and Visualizations -->
            <div id="dashboardCharts"></div>

            <!-- Recent Activity and Alerts -->
            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-top: 20px;
              "
            >
              <div id="recentActivity"></div>
              <div id="dashboardAlerts"></div>
            </div>

            <!-- Legacy Latest Cards (fallback) -->
            <div class="cards" id="latestCards" style="margin-top: 20px">
              <!-- cards injected for backward compatibility -->
            </div>
          </section>

          <!-- Page: Enhanced Form -->
          <section id="page-form" class="page" style="display: none">
            <h2 style="color: #ffbcbc">Buat Pengaduan Baru</h2>
            <p class="muted mb-10">
              Isi detail masalah dengan fitur GPS otomatis dan prioritas cerdas
            </p>

            <div class="card">
              <form id="reportForm" class="mb-10">
                <div class="form-row">
                  <div>
                    <label>Nama Lengkap</label>
                    <input
                      type="text"
                      id="inpName"
                      placeholder="Nama pelapor"
                      required
                    />
                  </div>
                  <div style="position: relative">
                    <label>Lokasi</label>
                    <input
                      type="text"
                      id="inpLocation"
                      placeholder="Contoh: Jl. Sukasari No.10 atau gunakan GPS"
                      required
                    />
                    <!-- GPS button akan ditambahkan di sini oleh JavaScript -->
                  </div>
                </div>

                <div style="margin-top: 10px">
                  <label>Judul Pengaduan</label>
                  <input
                    type="text"
                    id="inpTitle"
                    placeholder="Judul singkat"
                    required
                  />
                </div>

                <div style="margin-top: 10px">
                  <label>Deskripsi</label>
                  <textarea
                    id="inpDesc"
                    placeholder="Jelaskan masalah dengan detail..."
                    required
                  ></textarea>
                </div>

                <!-- Priority akan ditambahkan di sini oleh Escalation component -->

                <div style="margin-top: 10px">
                  <label>Bukti (foto / video)</label>
                  <input
                    type="file"
                    id="inpFiles"
                    accept="image/*,video/*"
                    multiple
                  />
                  <div class="file-preview" id="filePreview"></div>
                </div>

                <div style="margin-top: 12px; display: flex; gap: 8px">
                  <button type="submit" class="btn primary">
                    Kirim Pengaduan
                  </button>
                  <button type="button" id="clearForm" class="btn ghost">
                    Bersihkan
                  </button>
                  <button
                    type="button"
                    id="autoDetectBtn"
                    class="btn ghost"
                    onclick="Escalation.autoSetPriority()"
                  >
                    üß† Auto Prioritas
                  </button>
                </div>
              </form>

              <div id="formNotif" class="muted">
                Fitur GPS, deteksi prioritas otomatis, dan chat follow-up
                tersedia.
              </div>
            </div>
          </section>

          <!-- Page: Enhanced Reports -->
          <section id="page-reports" class="page" style="display: none">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 12px;
              "
            >
              <h2 style="color: #ffbcbc">Semua Pengaduan</h2>
              <!-- Export button akan ditambahkan di sini -->
            </div>
            <p class="muted mb-10">
              Filter, cari, dan kelola laporan dengan fitur lengkap
            </p>

            <div
              style="
                display: flex;
                gap: 10px;
                margin-bottom: 12px;
                flex-wrap: wrap;
              "
            >
              <select id="filterStatus">
                <option value="all">Semua Status</option>
                <option value="baru">Baru</option>
                <option value="proses">Proses</option>
                <option value="selesai">Selesai</option>
              </select>
              <!-- Priority filter akan ditambahkan di sini -->
              <select id="sortBy">
                <option value="newest">Terbaru</option>
                <option value="oldest">Terlama</option>
                <option value="priority">Berdasarkan Prioritas</option>
              </select>
            </div>

            <!-- Bulk actions akan ditambahkan di sini -->

            <div id="reportsList" class="cards"></div>
          </section>

          <!-- Page: Rating (unchanged) -->
          <section id="page-ratingPage" class="page" style="display: none">
            <h2 style="color: #ffbcbc">Rating Pemerintah Daerah</h2>
            <p class="muted mb-10">
              Berikan penilaian terkait tanggapan laporan
            </p>

            <div class="card">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                "
              >
                <div>
                  <div style="font-size: 1.05rem; font-weight: 700">
                    Nilai Rata-rata
                  </div>
                  <div
                    id="avgRating"
                    style="font-size: 1.6rem; color: #ffdede; margin-top: 6px"
                  >
                    ‚Äî
                  </div>
                  <div class="muted" id="totalRatings">0 review</div>
                </div>
                <div class="center">
                  <div style="font-size: 0.9rem; margin-bottom: 8px">
                    Beri Rating
                  </div>
                  <div class="rating" id="ratingInput">
                    <span class="star" data-value="1">&#9733;</span>
                    <span class="star" data-value="2">&#9733;</span>
                    <span class="star" data-value="3">&#9733;</span>
                    <span class="star" data-value="4">&#9733;</span>
                    <span class="star" data-value="5">&#9733;</span>
                  </div>
                  <textarea
                    id="ratingComment"
                    placeholder="Keterangan (opsional)"
                    style="
                      margin-top: 8px;
                      width: 220px;
                      padding: 8px;
                      background: #111;
                      color: #fff;
                      border-radius: 8px;
                      border: 1px solid rgba(255, 255, 255, 0.03);
                    "
                  ></textarea>
                  <div style="margin-top: 8px">
                    <button id="submitRating" class="btn primary">
                      Kirim Rating
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div style="margin-top: 14px" id="ratingList"></div>
          </section>

          <!-- Page: Profile (unchanged) -->
          <section id="page-profile" class="page" style="display: none">
            <h2 style="color: #ffbcbc">Profil Saya</h2>
            <p class="muted mb-10">Edit data profil</p>

            <div class="card">
              <form id="profileForm">
                <div class="form-row">
                  <div>
                    <label>Nama</label>
                    <input id="profile_name" type="text" />
                  </div>
                  <div>
                    <label>Email</label>
                    <input id="profile_email" type="email" />
                  </div>
                </div>

                <div style="margin-top: 12px">
                  <label>Avatar (initial atau image)</label>
                  <input id="profile_avatar" type="file" accept="image/*" />
                  <div style="margin-top: 8px">
                    <div class="thumb-preview" id="avatarPreview">Preview</div>
                  </div>
                </div>

                <div style="margin-top: 12px">
                  <button type="submit" class="btn primary">
                    Simpan Profil
                  </button>
                </div>
              </form>
            </div>
          </section>
        </main>
      </div>
    </div>

    <!-- Floating action button -->
    <div class="fab" id="fab">+</div>

    <!-- Modal backdrop for detail view -->
    <div class="modal-backdrop" id="modalBackdrop" aria-hidden="true">
      <div class="modal" role="dialog" aria-modal="true" id="modalContent">
        <!-- Enhanced modal content injected here -->
      </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/components/navigation.js"></script>
    <script src="js/components/profile.js"></script>
    <script src="js/components/reports.js"></script>
    <script src="js/components/rating.js"></script>
    <script src="js/components/modal.js"></script>

    <!-- New Enhanced Components -->
    <script src="js/components/chat.js"></script>
    <script src="js/components/gps.js"></script>
    <script src="js/components/escalation.js"></script>
    <script src="js/components/dashboard.js"></script>
    <script src="js/components/reports-enhanced.js"></script>

    <script src="js/app.js"></script>

    <script>
      // Initialize enhanced features after app loads
      document.addEventListener("DOMContentLoaded", function () {
        // Wait for main app to initialize
        setTimeout(() => {
          if (window.Chat && CONFIG.FEATURES.CHAT_SYSTEM) {
            Chat.init();
          }

          if (window.GPS && CONFIG.FEATURES.GPS_LOCATION) {
            GPS.init();
          }

          if (window.Escalation && CONFIG.FEATURES.AUTO_ESCALATION) {
            Escalation.init();
          }

          if (window.Dashboard) {
            Dashboard.init();
          }

          if (window.EnhancedReports) {
            // Replace Reports with EnhancedReports
            window.Reports = EnhancedReports;
            EnhancedReports.init();
          }

          console.log("Enhanced features initialized");
        }, 1000);
      });
    </script>
  </body>
</html>
